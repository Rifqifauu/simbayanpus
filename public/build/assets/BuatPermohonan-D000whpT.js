import{r as c,w as C,f as S,o as u,c as f,g as h,b as o,h as E,i as L,j as y,k as T,d as D,l as x,v as _,F as V,m as B,n as j,a as F,p as I,t as M,q as R}from"./app-DBr-amPc.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{A as O}from"./AppLayout-Dy7lUTt2.js";import{S as N}from"./SuccessModal-4EUGx5_s.js";import{E as q}from"./ErrorModal-qL7AgLcL.js";const A={name:"FilePreview",props:{file:{type:File,required:!0}},setup(m){const a=c(""),t=c(!1),e=c(!1),n=s=>{if(!s){a.value="",t.value=!1;return}s.type==="application/pdf"?(a.value=URL.createObjectURL(s),t.value=!0,e.value=!1):(e.value=!0,t.value=!1)};return C(()=>m.file,s=>{n(s)},{immediate:!0}),S(()=>{a.value&&URL.revokeObjectURL(a.value)}),{previewUrl:a,showPreview:t,error:e}}},z={class:"pdf-preview"},G={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},H={key:1,class:"mt-4"},X={class:"border rounded-lg overflow-hidden"},J=["src"];function K(m,a,t,e,n,s){return u(),f("div",z,[e.error?(u(),f("div",G," File harus berformat PDF ")):h("",!0),e.showPreview?(u(),f("div",H,[o("div",X,[o("iframe",{src:e.previewUrl,class:"w-full h-[600px]",type:"application/pdf"},null,8,J)])])):h("",!0)])}const Q=k(A,[["render",K]]),W={name:"InternshipForm",components:{SuccessModal:N,ErrorModal:q,FilePreview:Q},layout:O,setup(m){const a={cv:"CV / Daftar Riwayat Hidup",coverLetter:"Surat Pengantar Magang",proposal:"Proposal Magang",guidelines:"Pedoman Magang dari Universitas"},t=E({division:"default",startDate:"",endDate:"",cv:null,coverLetter:null,proposal:null,guidelines:null}),e=c({}),n=c(!1),s=c(""),v=c(!1),w=L(()=>t.startDate&&t.endDate&&t.cv&&t.coverLetter&&t.proposal&&new Date(t.startDate)<=new Date(t.endDate)),b=r=>l=>{e.value[r]=l},i=r=>{const l=r.target.files[0],p=r.target.dataset.key;if(l){const P=[".pdf",".doc",".docx"],U="."+l.name.split(".").pop().toLowerCase();if(!P.includes(U)){s.value="Format file tidak valid. Gunakan PDF, DOC, atau DOCX.",n.value=!0,r.target.value="";return}if(l.size>2*1024*1024){s.value="Ukuran file maksimal 2MB",n.value=!0,r.target.value="";return}t[p]=l}},d=r=>{const l=e.value[r];l&&l.click()},g=()=>{if(!t.startDate||!t.endDate)return s.value="Periode magang wajib diisi",n.value=!0,!1;if(new Date(t.startDate)>new Date(t.endDate))return s.value="Tanggal mulai tidak boleh lebih besar dari tanggal selesai",n.value=!0,!1;const r=["cv","coverLetter","proposal"];for(const l of r)if(!t[l])return s.value=`${a[l]} wajib diupload`,n.value=!0,!1;return!0};return{fileUploadFields:a,formData:t,fileInputs:e,showErrorModal:n,errorMessage:s,showSuccessModal:v,isFormValid:w,setFileInputReference:b,handleFileUpload:i,triggerFileInput:d,submitForm:async()=>{try{if(!g())return;const r=new FormData;r.append("division",t.division),r.append("startDate",t.startDate),r.append("endDate",t.endDate),Object.keys(a).forEach(p=>{t[p]&&r.append(p,t[p])}),(await I.post("/permohonan/create",r,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(v.value=!0,setTimeout(()=>{document.location.href="/permohonan"},2e3))}catch(r){if(r.response&&r.response.data.errors){const l=r.response.data.errors;s.value=l.email?l.email[0]:"Unknown error",n.value=!0,setTimeout(()=>{n.value=!1},2e3)}else s.value="Terjadi kesalahan tak terduga. Silakan coba lagi nanti.",n.value=!0,setTimeout(()=>{n.value=!1},2e3)}}}}},Y={class:"min-h-screen bg-gray-100 py-6 px-4 sm:px-6 lg:px-8"},Z={class:"max-w-2xl mx-auto"},$={class:"bg-red-600 rounded-lg shadow-lg p-6 text-white"},ee={class:"grid grid-cols-2 gap-4"},ae={class:"block text-yellow-300 mb-2"},te={class:"flex items-center space-x-2"},oe=["data-key"],re=["onClick"],se={class:"text-sm"},le=["disabled"];function ne(m,a,t,e,n,s){const v=y("FilePreview"),w=y("ErrorModal"),b=y("SuccessModal");return u(),f("div",Y,[o("div",Z,[a[9]||(a[9]=o("div",{class:"text-center mb-8"},[o("h1",{class:"text-3xl font-bold text-red-600"},"Daftar Magang"),o("p",{class:"text-gray-600"},"Isi data diri Anda di bawah ini!")],-1)),o("div",$,[o("form",{onSubmit:a[3]||(a[3]=T((...i)=>e.submitForm&&e.submitForm(...i),["prevent"])),class:"space-y-6"},[o("div",ee,[o("div",null,[a[6]||(a[6]=o("label",{class:"block text-yellow-300 mb-2"},[D("Periode Mulai "),o("span",{class:"text-yellow-200"},"*")],-1)),x(o("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=i=>e.formData.startDate=i),class:"w-full px-3 py-2 rounded-md text-gray-700 focus:outline-none focus:ring-2 focus:ring-yellow-300"},null,512),[[_,e.formData.startDate]])]),o("div",null,[a[7]||(a[7]=o("label",{class:"block text-yellow-300 mb-2"},[D("Periode Berakhir "),o("span",{class:"text-yellow-200"},"*")],-1)),x(o("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=i=>e.formData.endDate=i),class:"w-full px-3 py-2 rounded-md text-gray-700 focus:outline-none focus:ring-2 focus:ring-yellow-300"},null,512),[[_,e.formData.endDate]])])]),(u(!0),f(V,null,B(e.fileUploadFields,(i,d)=>(u(),f("div",{key:d},[o("label",ae,[D(M(i)+" ",1),a[8]||(a[8]=o("span",{class:"text-yellow-200"},"*",-1))]),o("div",te,[o("input",{type:"file",ref_for:!0,ref:e.setFileInputReference(d),"data-key":d,onChange:a[2]||(a[2]=g=>e.handleFileUpload(g)),class:"hidden",accept:".pdf,.doc,.docx"},null,40,oe),o("button",{type:"button",onClick:g=>e.triggerFileInput(d),class:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300"}," Pilih File ",8,re),o("span",se,M(e.formData[d]?e.formData[d].name:"Tidak ada file yang dipilih."),1)]),e.formData[d]&&e.formData[d].type==="application/pdf"?(u(),R(v,{key:0,file:e.formData[d],class:"mt-4"},null,8,["file"])):h("",!0)]))),128)),o("button",{type:"submit",disabled:!e.isFormValid,class:j(["w-full py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-300",e.isFormValid?"bg-yellow-400 hover:bg-yellow-500":"bg-gray-400 cursor-not-allowed"])}," Daftar ",10,le)],32)])]),F(w,{show:e.showErrorModal,message:e.errorMessage,title:"Pendaftaran Gagal",onClose:a[4]||(a[4]=i=>e.showErrorModal=!1)},null,8,["show","message"]),F(b,{show:e.showSuccessModal,title:"Pendaftaran Berhasil",onClose:a[5]||(a[5]=i=>e.showSuccessModal=!1)},null,8,["show"])])}const me=k(W,[["render",ne]]);export{me as default};
